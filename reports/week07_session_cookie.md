# 🔐 세션과 쿠키 기반 인증 흐름: 상태 유지 전략과 로그인 구조 예시

---

## 1. 인증 흐름 개요

### 📌 개요
- 웹은 **무상태(stateless)** 프로토콜(HTTP)을 기반으로 하여 클라이언트 상태를 기억하지 않음
- 로그인 상태 유지와 사용자 식별을 위해 **세션(Session)** 또는 **쿠키(Cookie)** 기반 인증 사용
- 인증 후에도 상태를 기억하기 위한 전략: **세션 저장**, **쿠키 전달**, **토큰 발급** 등

---

## 2. 상태 유지 전략: Session vs Cookie

| 항목 | 세션(Session) | 쿠키(Cookie) |
|------|----------------|---------------|
| 저장 위치 | 서버 (메모리/DB 등) | 클라이언트(브라우저) |
| 인증 정보 노출 | ❌ 서버 저장으로 상대적으로 안전 | ⚠️ 클라이언트 저장, 주의 필요 |
| 만료 제어 | 서버 설정으로 제어 | 클라이언트 만료시간 설정 |
| 용량 제한 | 서버 성능에 따라 제한 | 약 4KB |
| 부적절한 접근 시 | 서버에서 즉시 무효화 가능 | 탈취 시 제3자가 사용 가능 |
| 유지 방식 | 세션ID를 클라이언트에 전달 (보통 쿠키로) | 쿠키 자체에 인증 정보 저장 |
| 사용 예 | 전통적인 로그인 시스템 | 단순 사용자 정보 저장, 자동 로그인, JWT 저장 등 |

---

## 3. 인증 흐름 요약 구조

### ✅ 세션 기반 인증 구조
```
[클라이언트] ── 로그인 요청(ID/PW) ──▶ [서버]
                             └─ 세션 생성(SessionID)
[서버] ── Set-Cookie(SessionID) ──▶ [클라이언트]
[클라이언트] ── 쿠키(SessionID) 포함 요청 ──▶ [서버]
                            └─ 세션 확인 후 인증 처리
```

### ✅ 쿠키 기반 인증 구조
```
[클라이언트] ── 로그인 요청(ID/PW) ──▶ [서버]
                            └─ 인증 정보(토큰 등) 쿠키에 저장
[클라이언트] ── 쿠키 포함 요청 ──▶ [서버]
                            └─ 쿠키 내용 검증 후 인증 처리
```

---

## 4. 로그인 구조 적용 예시

### 🧩 세션 기반 예시 (Express.js + express-session)
```js
app.post("/login", (req, res) => {
  const { id, pw } = req.body;
  if (isValid(id, pw)) {
    req.session.user = { id }; // 서버에 세션 저장
    res.send("로그인 성공");
  } else {
    res.status(401).send("인증 실패");
  }
});
```

### 🧩 쿠키 기반 예시 (JWT + 쿠키 저장)
```js
app.post("/login", (req, res) => {
  const { id, pw } = req.body;
  if (isValid(id, pw)) {
    const token = jwt.sign({ id }, "SECRET_KEY", { expiresIn: "1h" });
    res.cookie("auth", token, { httpOnly: true });
    res.send("로그인 성공");
  } else {
    res.status(401).send("인증 실패");
  }
});
```

---

## 5. 전략 선택 기준

| 상황 | 적합한 방식 |
|------|-------------|
| 빠른 구축, 서버 중심 인증 관리 | 세션 기반 |
| 분산 서버, 무상태 인증, 모바일/SPA | 쿠키 기반(JWT 등) |
| 인증 외 정보 유지 (최근 본 상품 등) | 클라이언트 쿠키 |
| 보안 민감 정보 처리 | 세션 기반 + HTTPS |

---

## 💡 핵심 요약

- **세션**: 서버에 상태 저장, 클라이언트는 세션 ID만 전달. 보안에 유리하고 통제 용이
- **쿠키**: 클라이언트에 인증 정보 저장. 서버 부하 줄일 수 있으나 유출 위험 고려 필요
- **실전에서는** 보통 세션+쿠키를 함께 사용하거나 JWT 기반 쿠키 저장 방식으로 하이브리드 구성

> ✅ 요약: 상태 유지 전략은 목적, 보안 수준, 시스템 구조에 따라 선택.  
SPA나 모바일 환경에서는 **JWT+쿠키**, 서버 중심 앱은 **세션 기반 인증**이 일반적

---

> 작성자: [박재훈]  
> 날짜: 2025-07-27
